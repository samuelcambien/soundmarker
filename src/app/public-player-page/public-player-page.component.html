<app-public-page xmlns="http://www.w3.org/1999/html">
  <div class="container-fluid">

    <div class="player-header row">
      <div class="title col-md-8"><h4>{{track?.title}}</h4></div>
      <div class="cloud-icon col-md-2" (click)="download()">cloud icon</div>
      <div class="text-icon col-md-2" (click)="showComments = !showComments">text icon</div>
    </div>

    <div class="player-content row">

      <button *ngIf="isPlaying(); then pausebutton else playbutton"></button>

      <ng-template #pausebutton>
        <button class="pause-button col-md-2 btn btn-link" (click)="pause()">
          <svg width="90px" height="90px" viewBox="0 0 70 70" version="1.1" xmlns="http://www.w3.org/2000/svg">
            <defs></defs>
            <g id="Symbols" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd">
              <g id="public-player-s" transform="translate(-38.000000, -142.000000)">
                <g id="Group-2">
                  <g id="Group-4" transform="translate(38.000000, 129.000000)">
                    <g id="Group-5" transform="translate(0.000000, 13.000000)">
                      <circle id="Oval" fill="#5673AB" cx="35" cy="35" r="35"></circle>
                      <rect id="Rectangle-5" fill="#FFFFFF" x="38" y="21" width="8" height="28" rx="2"></rect>
                      <rect id="Rectangle-5" fill="#FFFFFF" x="25" y="21" width="8" height="28" rx="2"></rect>
                    </g>
                  </g>
                </g>
              </g>
            </g>
          </svg>
        </button>
      </ng-template>

      <ng-template #playbutton>
        <button class="play-button col-md-2 btn btn-link" (click)="play()">
          <svg width="90px" height="90px" viewBox="0 0 70 70" version="1.1" xmlns="http://www.w3.org/2000/svg">
            <defs></defs>
            <g id="Symbols" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd">
              <g id="public-player-s" transform="translate(-38.000000, -142.000000)">
                <g id="Group-2">
                  <g id="Group-4" transform="translate(38.000000, 129.000000)">
                    <g id="Group-5" transform="translate(0.000000, 13.000000)">
                      <g id="Group-6">
                        <circle id="Oval" fill="#5673AB" cx="35" cy="35" r="35"></circle>
                        <path
                          d="M41.2001413,23.6040044 L53.12746,43.3356181 C54.270271,45.2261943 53.6640875,47.6852404 51.7735114,48.8280514 C51.1492596,49.2053976 50.4337074,49.4048604 49.7042691,49.4048604 L25.8496316,49.4048604 C23.6404926,49.4048604 21.8496316,47.6139994 21.8496316,45.4048604 C21.8496316,44.675422 22.0490945,43.9598698 22.4264407,43.3356181 L34.3537594,23.6040044 C35.4965703,21.7134283 37.9556165,21.1072448 39.8461926,22.2500558 C40.4004672,22.5851023 40.8650947,23.0497299 41.2001413,23.6040044 Z"
                          id="Triangle-2" fill="#FFFFFF"
                          transform="translate(37.777246, 35.538758) rotate(90.000000) translate(-37.777246, -35.538758) "></path>
                      </g>
                    </g>
                  </g>
                </g>
              </g>
            </g>
          </svg>
        </button>
      </ng-template>

      <div class="player-container col-md-10">
        <div class="waveform-container">
          <div id="waveform" #waveform></div>
        </div>
        <div class="timebar-container">
          <div id="timebar">
            <div
              #startTime
              class="drag-block"
              mwlDraggable [dragAxis]="{x: true, y:false}"
              [validateDrag]="validateDragStart()"
              (dragStart)="startPos=startTime.offsetLeft"
              (dragEnd)="updateStartTime(startPos, $event)"
              [style.left]="getStartPosition()"
            >
              <ng-container *ngTemplateOutlet="soundmarker"></ng-container>
            </div>
            <div
              #endTime
              class="drag-block"
              [class.invisible]="!comment.includeEnd"
              mwlDraggable [dragAxis]="{x: true, y:false}"
              (dragStart)="startPos=endTime.offsetLeft"
              (dragEnd)="updateEndTime(startPos, $event)"
              [validateDrag]="validateDragEnd()"
              [style.left]="getEndPosition()"
            >
              <ng-container *ngTemplateOutlet="soundmarker"></ng-container>
            </div>

            <ng-template #soundmarker>
              <svg width="10px" height="140px" viewBox="0 0 10 140" version="1.1" xmlns="http://www.w3.org/2000/svg">
                <line x1="5" y1="0" x2="5" y2="130" style="stroke:rgb(0,0,255);stroke-width:2px"></line>
                <circle cx="5" cy="135" r="5"></circle>
              </svg>
            </ng-template>

          </div>
        </div>
        <div class="time float-left"><h5>{{formatTime(5)}}</h5></div>
        <div class="time float-right"><h5>{{formatTime(duration)}}</h5></div>
      </div>

    </div>

    <div class="comments" [ngbCollapse]="!showComments">

      <div class="comments-header">
        <div><h3>{{comments?.length}} comments</h3></div>
        <div>
          <a class="nav-link dropdown-toggle" data-toggle="dropdown" href="#" role="button" aria-haspopup="true"
             aria-expanded="false">sort icon</a>

          <div class="dropdown-menu">
            <a *ngFor="let sorter of commentSorters" (click)="currentSorter = sorter" class="dropdown-item">
              {{sorter.description}}
            </a>
          </div>
        </div>
      </div>

      <app-comment-form [version_id]="track?.last_version" [comment]="comment" [player]="player"></app-comment-form>

      <app-comment
        *ngFor="let comment of getCommentsSorted()"
        [player]="player"
        [comment]="comment">
      </app-comment>

    </div>
  </div>
</app-public-page>
