<app-pro-board-card id="pro">
	<ng-container class="title">Upload settings
		<!-- <button *ngIf="!this.stateService.getVersionUpload().getValue()" (click)="createNewProject = !createNewProject;" type="button" class="btn btn-sm btn-primary free-upload" [class.disabled]="!user_project_list.length">{{ createNewProject == false ? 'Existing' : 'New' }} Project</button> -->
	</ng-container>
	<ng-container class="body">
		<form #myForm="ngForm" (ngSubmit)="onSubmit()">
			<div class="form-row pro-form-container">
				<div class="col-sm-12">
					<div class="form-row" *ngIf="!this.stateService.getVersionUpload().getValue()">
						<div class="col-sm-8">
							<input class="form-control form-control-sm" placeholder="Project title" name="projecttitle" [(ngModel)]="smUploader.project_title" >
						</div>
						<div class="col-sm-4" >
							<div class="">
								<ng-select class="custom noselect expiration"
                           bindLabel="title"
                           bindValue="project_id"
                           groupBy="heading"
                           [items]="user_project_list"
                           [searchable]="false"
                           [clearable]="false"
                           [(ngModel)]="project_id"
                           (close)="getProjectInfo(project_id)"
                           placeholder="Existing projects*"
                           name="existing_projects"
                           dropdownPosition="auto" ></ng-select>
							</div>
						</div>
					</div>
					<div class="form-row" *ngIf="!this.stateService.getVersionUpload().getValue()">
						<div class="col-sm-12">
							<tag-input [(ngModel)]='smUploader.email_to'
                         [trimTags]="true" [separatorKeyCodes]="[13, 188, 186]"
                         [addOnBlur]="true" [maxItems]="5"
                         [ripple]="false"
                         [animationDuration]="{enter: '0ms', leave: '0ms'}"
                         [modelAsStrings]="true"
                         [validators]="validators"
                         placeholder="Email to"
                         secondaryPlaceholder="Email to"
                         name="email_to"
                         class="form-control form-control-sm" id="tag-input-email"
                         ngbTooltip="Invalid email address" triggers="manual"
                         #t="ngbTooltip"></tag-input>
						</div>
					</div>
					<div class="form-row">
						<div class="form-group col hide-phone">
							<textarea #notes_element [(ngModel)]="smUploader.notes" type="text" placeholder="Notes" name="notes" class="form-control
                          form-control-sm" rows="2"></textarea>
						</div>
						<div class="form-group col show-phone">
							<textarea #notes_element [(ngModel)]="smUploader.notes" type="text" placeholder="Notes" name="notes" class="form-control
                          form-control-sm" rows="5"></textarea>
						</div>
					</div>
					<div class="form-row radios" *ngIf="!this.stateService.getVersionUpload().getValue()">
						<div class="col">
							<label class="custom expiration btn btn-sm btn-outline-form btn-settings noselect" popoverClass="popover-class" ngbPopover="Allow downloading of uploaded tracks" [openDelay]="300" [autoClose]="false" triggers="mouseenter:mouseleave">
								<div class="switch">
									<input type="checkbox" [checked]="smUploader.availability" (click)="smUploader.toggleAvailability()"> <span class="slider round"></span>
								</div>
								<div id="enable-download-button" [ngClass]="{'unchecked': !smUploader.availability}" class="slider-text">Downloads</div>
							</label>
						</div>
						<div class="col">
							<label class="custom noselect downloadable btn btn-sm btn-outline-form btn-settings" popoverClass="popover-class" ngbPopover="Allow lossless streaming" [openDelay]="300" [autoClose]="false" triggers="mouseenter:mouseleave">
								<div class="switch">
									<input type="checkbox" [checked]="smUploader.stream_type" (click)="smUploader.toggleStreamType()"> <span class="slider round"></span>
								</div>
								<div [ngClass]="{'unchecked': !smUploader.stream_type}" class="slider-text">Lossless</div>
							</label>
						</div>
						<div class="col">
							<label class="custom noselect downloadable btn btn-sm btn-outline-form btn-settings" popoverClass="popover-class" ngbPopover="Set extra password protection" [openDelay]="300" [autoClose]="false" triggers="mouseenter:mouseleave">
								<div class="switch">
									<input type="checkbox" [checked]="smUploader.smppw_bool" (click)="smUploader.toggleSMPpw()"> <span class="slider round"></span>
								</div>
								<div [ngClass]="{'unchecked': !smUploader.smppw_bool}" class="slider-text">Password</div>
							</label>
						</div>
						<div class="col" *ngIf="!this.stateService.getVersionUpload().getValue()">
							<input [disabled]="!smUploader.smppw_bool" name="smppwv" [(ngModel)]="smUploader.smppw" class="sub-form" placeholder="Min. 6 characters" >
						</div>
					</div>
					<div class="form-field bottom-tooltip" placement="bottom" [ngbTooltip]="" #ft='ngbTooltip' triggers="manual" (click)="ft.close()">
						<div class="card   rounded border-0">
              <div  class="pro-add-more-tracks">
              </div>
              <div class="pro-upload-list-container">
								<div class="form-row" *ngFor="let item of smUploader.getFileUploader().queue; index as i">
									<div class="col-sm-4">
										<input class="sub-form"
                           *ngIf="!selected_existing_tracks[i]"
                           [(ngModel)]="smUploader.titles[i]" name="title-{{i}}" >
										<div class="sub-form disabled" *ngIf="selected_existing_tracks[i]">{{getTrackTitle(selected_existing_tracks[i])}}</div>
									</div>
									<div class="col">
										<div class="btn-sm btn-outline-form static">{{item.file.type.substring(6).toUpperCase()}} Â· {{getFileSize(item)}}</div>
									</div>
									<div class="col">
										<ng-select  [(ngModel)]="selected_existing_tracks[i]"
                               *ngIf="!createNewProject && !this.stateService.getVersionUpload().getValue()"
                               class="custom noselect
                               downloadable ng-option-disabled"
                               bindLabel="title" bindValue="track_id"
                               [searchable]="false"
                               (change)="addVersion(i, $event)"
                               placeholder="Add as new version*"
                               name="version_track_{{i}}"
                               dropdownPosition="auto"
                               (clear)="removeVersion(i)">
											<ng-option *ngFor="let item of project_tracks_list" [value]="item.track_id" [disabled]="item.disabled">{{item.title}}</ng-option>
										</ng-select>
									</div>
									<div class="col pro-remove-track">
										<div *ngIf="!this.stateService.getVersionUpload().getValue()" (click)="removeFromQueue(item, i)" class="btn-sm btn-outline-form" aria-hidden="true"> <span class="">
                  <svg width="9px" height="9px" viewBox="0 0 9 9" version="1.1" xmlns="http://www.w3.org/2000/svg">
                  <g id="Page-1" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd" stroke-linecap="round">
                  <g id="Internet-Networks-Servers-/-Upload/Download-/-upload-dash-arrow-1"
                     transform="translate(-344.000000, -234.000000)" fill-rule="nonzero" stroke="#7397FF" stroke-width="1.5">
                  <path d="M345.5,235.5 L351.488196,241.488196" id="Line-8"></path>
                  <path d="M345.5,235.5 L351.488196,241.488196" id="Line-8"
                        transform="translate(348.500000, 238.500000) scale(-1, 1) translate(-348.500000, -238.500000) "></path>
                  </g>
                  </g>
                  </svg>
              </span>
										</div>
									</div>
								</div>
							</div>

							<div class="form-row mb-5p">
                <div class="col-sm-3" *ngIf="!this.stateService.getVersionUpload().getValue()">
                  <input class="upload-songs-input" id="pro-uploader" type="file" title="" ng2FileSelect [uploader]="smUploader.getFileUploader()" multiple name="files" accept="{{smUploader.getAcceptedFileTypes().join(',')}}">
									<button type="button" class="btn btn-sm btn-outline-form free-upload" placement="bottom" (click)="cancelUpload(myForm.dirty, smUploader.getFileUploader().getNotUploadedItems().length )">+ Add more tracks</button>
								</div>
                  <div class="col-sm-4"></div>
								<div class="col-sm-2">
									<button type="button" class="btn btn-sm btn-outline-form free-upload" placement="bottom" (click)="cancelUpload(myForm.dirty, smUploader.getFileUploader().getNotUploadedItems().length )">Clear form</button>
								</div>
								<div class="col-sm-3">
									<button type="submit" [disabled]="!smUploader.getFileUploader().getNotUploadedItems().length || !myForm.valid" class="btn btn-sm btn-primary free-upload" placement="bottom">Upload {{ this.stateService.getVersionUpload().getValue() == true ? 'new version' : 'tracks' }}</button>
								</div>
							</div>
						</div>
					</div>
				</div>
			</div>
		</form>
		<div ng2FileDrop [uploader]="smUploader.getFileUploader()" class="well my-drop-zone"></div>
		<app-confirm-dialog></app-confirm-dialog>
	</ng-container>
</app-pro-board-card>
