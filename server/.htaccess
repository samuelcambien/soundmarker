<IfModule mod_rewrite.c>
    <IfModule mod_negotiation.c>
        Options -MultiViews
    </IfModule>

    RewriteEngine On

    # Redirect to https
    RewriteCond %{ENV:EnvType} Production
    RewriteCond %{HTTP:X-Forwarded-Proto} ^http$
    RewriteRule ^(.*)$ https://%{HTTP_HOST}%{REQUEST_URI} [L,R=301]

    # Redirect Trailing Slashes If Not A Folder...
    RewriteCond %{REQUEST_FILENAME} !-d
    RewriteRule ^(.*)/$ /$1 [L,R=301]

    # Handle Front Controller...
    RewriteCond %{REQUEST_URI} "/file/upload" [OR]
    RewriteCond %{REQUEST_URI} "/file/new" [OR]
    RewriteCond %{REQUEST_URI} "/track/url" [OR]
    RewriteCond %{REQUEST_URI} "/track/file/download/" [OR]
    RewriteCond %{REQUEST_URI} "/track" [OR]
    RewriteCond %{REQUEST_URI} "/track/new" [OR]
    RewriteCond %{REQUEST_URI} "/track/visibility" [OR]
    RewriteCond %{REQUEST_URI} "/track/version" [OR]
    RewriteCond %{REQUEST_URI} "/track/version/edit" [OR]
    RewriteCond %{REQUEST_URI} "/track/version/comments" [OR]
    RewriteCond %{REQUEST_URI} "/track/version/comment" [OR]
    RewriteCond %{REQUEST_URI} "/track/version/delete/comment" [OR]
    RewriteCond %{REQUEST_URI} "/project/set/viewpassword" [OR]
    RewriteCond %{REQUEST_URI} "/project/new" [OR]
    RewriteCond %{REQUEST_URI} "/project/all" [OR]
    RewriteCond %{REQUEST_URI} "/project/edit" [OR]
    RewriteCond %{REQUEST_URI} "/project/password" [OR]
    RewriteCond %{REQUEST_URI} "/project/delete" [OR]
    RewriteCond %{REQUEST_URI} "/project/subscribe" [OR]
    RewriteCond %{REQUEST_URI} "/project/([a-z0-9/-]+)$" [OR]
    RewriteCond %{REQUEST_URI} "/file/chunk/([a-z0-9/-]+)$" [OR]
    RewriteCond %{REQUEST_URI} "/unsubscribe/([a-z0-9/-]+)$" [OR]
    RewriteCond %{REQUEST_URI} "/subscribe/([a-z0-9/-]+)$" [OR]
    RewriteCond %{REQUEST_URI} "/sma"
    RewriteRule ^ index.php [L]

    # Prefer .php over .html
    DirectoryIndex index.php index.html index.shtml index.htm Index.html Index.htm Index.shtml default.htm Default.htm default.html Default.html default.shtml Default.shtml page1.html index.pl index.cgi index.php3 index.phtml home.htm home.html home.shtml index.wml index.pcgi quickstart.html
    Header set Access-Control-Allow-Origin "http://localhost:4200"
</IfModule>

# password protect single file
<If "%{ENV:EnvType} == 'Staging'">
<Files "index.html">
AuthType Basic
AuthName "Private section"
AuthUserFile /etc/httpd/.htpasswd
Require user soundmarker
</Files>
<FilesMatch "^$">
AuthType Basic
AuthName "Private section"
AuthUserFile /etc/httpd/.htpasswd
Require user soundmarker
</FilesMatch>
</If>
